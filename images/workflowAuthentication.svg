<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2770.6px" preserveAspectRatio="none" style="width:1552px;height:2770px;" version="1.1" viewBox="0 0 1552 2770" width="1552.6px" zoomAndPan="magnify"><defs><filter height="300%" id="fnkakhcmzkjcp" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.3999999999999997"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="2.7999999999999994" dy="2.7999999999999994" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><image height="44.8" width="44.8" x="664.475" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAH70lEQVR4Xu2bCUwUVxiAV0AXxHCqC0oRVBCkIqiVVbAILtKSoihaBVNLpRWoJ5RDlAoVEUQRBIVK0EptPdKotbbeR9Ua7db7wDseqbFXrD1s0vPv+//tTHbnqbDussWRl3xh8+b/38z/7RxvZgeForW1Nku2vowcRslDwGUYI8uW2KZNm7/YX3gU/8UkilkyardYcRAfHw+pqakiKSkpkJCQAOPGjYOoqCgUgCJuSZOf9NaWAZ06dYK6ujqOkpISKCwsJFxcXIS9AXNk1f50dnbmikeKi4tFAQ4ODlj8n9JkObR7dnZ2XPFIUVGRKMDW1hYF3JUmy6F9bWVlxRWPzJ8/XxRgbW0ty3MAtosMqK6u5gQIxefn5wvH/3lJrizaMQaUl5cbFF9bWysKyM3NFQRoJbmyaLsYdLzrC1ixYoUoYMaMGYKA3ZJcWbQ1DMjJyTEQUFNTIwpITk4WBHwgyZVFK2PQ5EdfwLJly0QB48ePFwRgrOxaNoNmffoCKisrRQGxsbGCAIyVXUtiQExMjIGAiooKUUBERIQg4FXDVMs0K8ZQxkyF7q5MShbDRwhmzV+h+6akcQ+jngGhoaEGAsrKykQBQUFBgoDVD8g3B1hbuEJXq0HzZZxU6Fb+UPoPDD177uZvJUhg8MAG6fKmEBAQYCCgtLRUFODl5cXFNxPHFXpfphvjNi7o3ScYpmXmQ35xFUfBwuWwV3sVzt68T+w5epn6pHEPY05hOa1cpVIZCNC/D3B0dKQYjJXmPy5zF1RB9rxKeKtgKSTPeBt8A3R7GbvrxJo7o4Aq7IgZ+TKcuvaTWGBz4OzaEWxsbGjyIwgQpsEFBQWAU2WMkeaZyunr9+FAw8/wOWPv2bsQGTNG2BMqUADdpx84cYNLNJXth87BiyPGgld3H/Dw9GbFt6UV426PxevPAtPT02kZxmAs5uCXsuOL89y4j8ORy7+QAGTzoavCc4ebKOCvzm5duART+bLhW+ji4Sk99oisrCwSoD8JSkpK4uKQrs90A+2F77jxjUV75VdRANKxszuOj0+fFGxDu3EJplJTv5kKcHV1pcubRqMBb29v6sNiUYD+JCguLo6WYQzGYg7mYl9N/cfc+MaivWoowK2r+OU0j4C6ddtoBXhiU6vVdPnr2bMn9UVGRtLJb+7cuZCRkUGEhITQMozBWMwRToor12/nxjcWiws4ee0e+AX0NdidHwf/Z4NoLOn4xmJxAciRc3dg8rRsCBsaBeqwCKPAnJRpOTSGdNzH4X8R0JJoFWCsgK8ufg85+aUwdkIyjEmcZDJTMvJg31fXuPVYCqMEHL9y1ywnMCmOTi6w68hFbuMsgVECFpTX0cLOvoMgNHUlhKWtMhnvwbqHHYlJadzGWQKjBLwxNYsWPvfKYhhdftEsDJ+zi8bEM7x04yyBUQKS33yLFg6cWMYVgowsPQWBcbng4hUE7do7gI2yPTh59Ab/F6ZCbJGWi0ei83bTmCGDw7mNswRmE6DJ/gTsXT2EZHCwbw+ujvRzFqG0d4YhU+q5PFkIeOHtvaDsoPvxcnTkEDi9YSXAif3Eta1rISU+lu6yrNsqISL9I6MF4B0p3kGaG3x2YRYB7gG6Z3YzE8eIhUupzJ5GMY7uvjCq7HyTBby/cQ89DxD2JHMza16FaQKi8/ZQX/eu7vCHdjdXuD5DB+ieuoSlrmqygIMnbsKw6BHclNgcRAx/CTbsOGaagH7ji6gvd9IErmApK/OzKbaXZnKTBTQ3Jh8CAS9lUN+7czK4gqXsW7GEYr1C4uUjIHjsO9Q3L+01rmApaxfkUaxPxCT5CBiWtYX6gv184J/j+7ii9Ykf9jzFqidVyUcA4tJNd39QlTOdK1rg06XFdCm0c3KjCZMxAo5d+gEOn7ltdvD5pFkERGZsZNd4W7pczU6eAD8f+kws/Pcvd0NF5lRQtmvHBFjBoORqg9zGBKzfegiUSno9xuzg9hYsqjVdwLDMzeDq3U8c2E6phEGBARAW1AccO9iL/fYdPekSOGpJQ5MF4GSlf0gY/ThjboIHDIL6zQdNELDkAvhHT+XMNobKbwiMKDneJAHNjUmHgHAFcGG7d6mfH+xXq0EbGvpADg8eDLV9+oCPvW6P8FKPfbIF4HQW5/827LjeExIC32o0TeJSeDio2CGC54Phs3e2OAET03LAydmV3kR5pABN9lb6rHZy4opsjFRPneX+CQtanADkcMOP3RoVED59HX0e7ebGFdgYhb6+lBs4avZTLiAut1EBm3ZqwdHJmWLMja1deyhZ9qFB8QXl9eDh6VWgwICWIGDbwbPQw8ePfhk2N9179oJ31+4wENDVsztuz98tRkBzIz0EmnwVeCoFpEyfRQsHTFhoNgFRudvpc2i4hts4S2CUgIpaXdEO7r50S4ufgx0cYLG/v1GMVKko1yPoRXDzD6fPr0/J5DbOEhgl4PT1X2CoJkYIMBvePXzp7ky6cZbgUQL+ftArMmdu/ArVqzdBxuwiSJ9VaDILK9+j213peiwF94qMqgsWT1eBr/H+/eDJW1ySnDiq95LUlsPXDf45aznuCiPiE2nXlybKgTM37sOBC7ri9527B9EjE4TdH18RVLgzG99gR2DwQMjMK4ay6jWyYdHyNVBYUU8zv7SsIujd9zkqntV8h/1VoQBsvRln/rPyNHCa4aeQNGvGcIXupWLpv7TKBawtSqGrtbW1Ntb+BXIFrYguSTZUAAAAAElFTkSuQmCC" y="8.4"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacing" textLength="0" x="712.775" y="50.4314"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacing" text-decoration="underline" textLength="170.8" x="712.775" y="50.4314">IDP signed challenge workflow</text><rect fill="#87CEEB" height="2708.2945" rx="7" ry="7" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="493.5" x="877.45" y="58.8"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="21.2461" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="62.65" y="896.3555"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="214.3148" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="179.55" y="124.3266"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="184.6305" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="179.55" y="1988.4156"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="164.3305" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="179.55" y="2425.6531"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="21.2461" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="179.55" y="2671.9219"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="242.5609" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="472.85" y="489.218"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="103.8844" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="472.85" y="813.7172"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="82.1844" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="472.85" y="1021.2398"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="117.1844" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="472.85" y="2152.0461"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="32.6922" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="472.85" y="2392.9609"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="102.9383" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="780.85" y="2568.9836"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="81.9383" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="922.25" y="407.2797"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="63.7383" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="922.25" y="571.8562"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="128.3844" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="1054.55" y="710.7789"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="161.3227" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="1054.55" y="1183.5086"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="114.3844" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="1054.55" y="1448.1086"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="191.6687" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="1054.55" y="1681.2086"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="144.7305" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="1326.85" y="2248.2305"/><rect fill="#FFFFE0" filter="url(#fnkakhcmzkjcp)" height="950.3758" rx="7" ry="7" style="stroke:#000000;stroke-width:1.3999999999999997;" width="1085" x="238" y="956.1016"/><rect fill="#EEEEEE" height="186.1617" style="stroke:none;stroke-width:0.6999999999999998;" width="1085" x="238" y="1409.9312"/><rect fill="#FFEEEE" height="310.3844" style="stroke:none;stroke-width:0.6999999999999998;" width="1085" x="238" y="1596.093"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:5.0,5.0;" x1="65.8" x2="65.8" y1="117.3266" y2="2705.768"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:5.0,5.0;" x1="182.7" x2="182.7" y1="117.3266" y2="2705.768"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:5.0,5.0;" x1="476.35" x2="476.35" y1="117.3266" y2="2705.768"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:5.0,5.0;" x1="784.35" x2="784.35" y1="117.3266" y2="2705.768"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:5.0,5.0;" x1="925.75" x2="925.75" y1="117.3266" y2="2705.768"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:5.0,5.0;" x1="1058.05" x2="1058.05" y1="117.3266" y2="2705.768"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:5.0,5.0;" x1="1330.35" x2="1330.35" y1="117.3266" y2="2705.768"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="56.7" x="35.7" y="115.1732">Versicherte:r</text><ellipse cx="66.15" cy="65.1" fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" rx="5.6" ry="5.6" style="stroke:#A80036;stroke-width:1.3999999999999997;"/><path d="M66.15,70.7 L66.15,89.6 M57.05,76.3 L75.25,76.3 M66.15,89.6 L57.05,100.1 M66.15,89.6 L75.25,100.1 " fill="none" filter="url(#fnkakhcmzkjcp)" style="stroke:#A80036;stroke-width:1.3999999999999997;"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="56.7" x="35.7" y="2715.2412">Versicherte:r</text><ellipse cx="66.15" cy="2724.3945" fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" rx="5.6" ry="5.6" style="stroke:#A80036;stroke-width:1.3999999999999997;"/><path d="M66.15,2729.9945 L66.15,2748.8945 M57.05,2735.5945 L75.25,2735.5945 M66.15,2748.8945 L57.05,2759.3945 M66.15,2748.8945 L75.25,2759.3945 " fill="none" filter="url(#fnkakhcmzkjcp)" style="stroke:#A80036;stroke-width:1.3999999999999997;"/><rect fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" height="22.1266" rx="7" ry="7" style="stroke:#A80036;stroke-width:1.0499999999999998;" width="52.5" x="155.4" y="91.7"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="42.7" x="160.3" y="106.7732">Fachlogik</text><rect fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" height="22.1266" rx="7" ry="7" style="stroke:#A80036;stroke-width:1.0499999999999998;" width="52.5" x="155.4" y="2705.068"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="42.7" x="160.3" y="2720.1412">Fachlogik</text><rect fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" height="22.1266" rx="7" ry="7" style="stroke:#A80036;stroke-width:1.0499999999999998;" width="68.6" x="440.65" y="91.7"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="58.8" x="445.55" y="106.7732">Authenticator</text><rect fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" height="22.1266" rx="7" ry="7" style="stroke:#A80036;stroke-width:1.0499999999999998;" width="68.6" x="440.65" y="2705.068"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="58.8" x="445.55" y="2720.1412">Authenticator</text><rect fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" height="22.1266" rx="7" ry="7" style="stroke:#A80036;stroke-width:1.0499999999999998;" width="58.8" x="753.55" y="91.7"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="49" x="758.45" y="106.7732">Fachdienst</text><rect fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" height="22.1266" rx="7" ry="7" style="stroke:#A80036;stroke-width:1.0499999999999998;" width="58.8" x="753.55" y="2705.068"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="49" x="758.45" y="2720.1412">Fachdienst</text><rect fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" height="22.1266" rx="7" ry="7" style="stroke:#A80036;stroke-width:1.0499999999999998;" width="74.2" x="887.25" y="91.7"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="64.4" x="892.15" y="106.7732">IDP_Discovery</text><rect fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" height="22.1266" rx="7" ry="7" style="stroke:#A80036;stroke-width:1.0499999999999998;" width="74.2" x="887.25" y="2705.068"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="64.4" x="892.15" y="2720.1412">IDP_Discovery</text><rect fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" height="22.1266" rx="7" ry="7" style="stroke:#A80036;stroke-width:1.0499999999999998;" width="88.2" x="1012.55" y="91.7"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="78.4" x="1017.45" y="106.7732">IDP_Authorization</text><rect fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" height="22.1266" rx="7" ry="7" style="stroke:#A80036;stroke-width:1.0499999999999998;" width="88.2" x="1012.55" y="2705.068"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="78.4" x="1017.45" y="2720.1412">IDP_Authorization</text><rect fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" height="22.1266" rx="7" ry="7" style="stroke:#A80036;stroke-width:1.0499999999999998;" width="58.8" x="1299.55" y="91.7"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="49" x="1304.45" y="106.7732">IDP_Token</text><rect fill="#FEFECE" filter="url(#fnkakhcmzkjcp)" height="22.1266" rx="7" ry="7" style="stroke:#A80036;stroke-width:1.0499999999999998;" width="58.8" x="1299.55" y="2705.068"/><text fill="#000000" font-family="sans-serif" font-size="9.8" lengthAdjust="spacing" text-decoration="underline" textLength="49" x="1304.45" y="2720.1412">IDP_Token</text><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="21.2461" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="62.65" y="896.3555"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="214.3148" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="179.55" y="124.3266"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="184.6305" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="179.55" y="1988.4156"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="164.3305" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="179.55" y="2425.6531"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="21.2461" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="179.55" y="2671.9219"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="242.5609" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="472.85" y="489.218"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="103.8844" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="472.85" y="813.7172"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="82.1844" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="472.85" y="1021.2398"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="117.1844" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="472.85" y="2152.0461"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="32.6922" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="472.85" y="2392.9609"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="102.9383" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="780.85" y="2568.9836"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="81.9383" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="922.25" y="407.2797"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="63.7383" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="922.25" y="571.8562"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="128.3844" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="1054.55" y="710.7789"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="161.3227" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="1054.55" y="1183.5086"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="114.3844" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="1054.55" y="1448.1086"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="191.6687" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="1054.55" y="1681.2086"/><rect fill="#FFFFFF" filter="url(#fnkakhcmzkjcp)" height="144.7305" style="stroke:#A80036;stroke-width:0.6999999999999998;" width="7" x="1326.85" y="2248.2305"/><path d="M33.6,134.8266 L33.6,173.3266 A7,7 0 0 0 40.6,180.3266 L1355.2,180.3266 A7,7 0 0 0 1362.2,173.3266 L1362.2,134.8266 L1355.2,127.8266 L40.6,127.8266 A7,7 0 0 0 33.6,134.8266 " fill="#FFFFE0" filter="url(#fnkakhcmzkjcp)" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><path d="M1355.2,127.8266 L1355.2,131.3266 A3.5,3.5 0 0 0 1358.7,134.8266 L1362.2,134.8266 L1355.2,127.8266 " fill="#FFFFE0" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="144.2" x="428.225" y="140.7731">In the following sequence diagramm</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="0" x="433.825" y="152.2192"/><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="44.1" x="433.825" y="152.2192">jwt(XXXX)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="113.4" x="480.725" y="152.2192">denotes a JSON web token,</text><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="46.9" x="599.725" y="152.2192">jwe(XXXX)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="161" x="649.425" y="152.2192">denotes an encrypted JSON web token,</text><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="39.9" x="813.225" y="152.2192">jwk(XXX)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="102.9" x="855.925" y="152.2192">denotes a JSON web key</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="0" x="431.025" y="163.6653"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="152.6" x="428.225" y="175.1114">lightgreen hexagons contain PKI infos</text><polygon fill="#A80036" points="775.95,227.757,782.95,230.557,775.95,233.357,778.75,230.557" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="186.55" x2="780.15" y1="230.557" y2="230.557"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="7.7" x="191.45" y="227.1575">1)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="52.5" x="204.75" y="227.1575">GET CertList</text><polygon fill="#A80036" points="194.25,249.0031,187.25,251.8031,194.25,254.6031,191.45,251.8031" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:2.0,2.0;" x1="190.05" x2="783.65" y1="251.8031" y2="251.8031"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="7.7" x="198.45" y="248.4036">2)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="83.3" x="211.75" y="248.4036">RETURN certificates</text><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="2.1" style="stroke:#EEEEEE;stroke-width:0.6999999999999998;" width="1548.05" x="0" y="272.2262"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="272.2262" y2="272.2262"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="274.3262" y2="274.3262"/><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="17.0461" style="stroke:#000000;stroke-width:1.3999999999999997;" width="102.9" x="722.575" y="264.4031"/><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="90.3" x="726.775" y="276.6497">choose code verifier</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="186.55" x2="215.95" y1="304.0953" y2="304.0953"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="215.95" x2="215.95" y1="304.0953" y2="313.1953"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="187.25" x2="215.95" y1="313.1953" y2="313.1953"/><polygon fill="#A80036" points="194.25,310.3953,187.25,313.1953,194.25,315.9953,191.45,313.1953" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="7.7" x="191.45" y="300.6958">3)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="109.9" x="204.75" y="300.6958">generate CODE_VERIFIER</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="186.55" x2="215.95" y1="337.9414" y2="337.9414"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="215.95" x2="215.95" y1="337.9414" y2="347.0414"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="183.05" x2="215.95" y1="347.0414" y2="347.0414"/><polygon fill="#A80036" points="190.05,344.2414,183.05,347.0414,190.05,349.8414,187.25,347.0414" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="7.7" x="191.45" y="334.5419">4)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="193.9" x="204.75" y="334.5419">CODE_CHALLENGE = hash(CODE_VERIFIER)</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="413.7,325.4453,445.9,325.4453,452.9,333.8453,445.9,342.2453,413.7,342.2453,406.7,333.8453,413.7,325.4453" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="29.4" x="415.1" y="337.6919">sha256</text><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="2.1" style="stroke:#EEEEEE;stroke-width:0.6999999999999998;" width="1548.05" x="0" y="363.9645"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="363.9645" y2="363.9645"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="366.0645" y2="366.0645"/><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="17.0461" style="stroke:#000000;stroke-width:1.3999999999999997;" width="93.1" x="727.475" y="356.1414"/><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="77.7" x="731.675" y="368.388">get discovery doc</text><polygon fill="#A80036" points="913.85,404.4797,920.85,407.2797,913.85,410.0797,916.65,407.2797" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="476.35" x2="918.05" y1="407.2797" y2="407.2797"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="7.7" x="481.25" y="398.1571">5)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="98.7" x="494.55" y="392.4341">getDiscoveryDocument()</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="52.5" x="494.55" y="403.8802">GET uri_disc</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="929.25" x2="958.65" y1="428.5258" y2="428.5258"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="958.65" x2="958.65" y1="428.5258" y2="437.6258"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="929.95" x2="958.65" y1="437.6258" y2="437.6258"/><polygon fill="#A80036" points="936.95,434.8258,929.95,437.6258,936.95,440.4258,934.15,437.6258" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="7.7" x="934.15" y="425.1263">6)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="102.2" x="947.45" y="425.1263">build discovery document</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="929.25" x2="958.65" y1="458.8719" y2="458.8719"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="958.65" x2="958.65" y1="458.8719" y2="467.9719"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="929.95" x2="958.65" y1="467.9719" y2="467.9719"/><polygon fill="#A80036" points="936.95,465.1719,929.95,467.9719,936.95,470.7719,934.15,467.9719" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="7.7" x="934.15" y="455.4724">7)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="100.1" x="947.45" y="455.4724">sign discovery document</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="1062.6,449.8758,1150.1,449.8758,1157.1,458.2758,1150.1,466.6758,1062.6,466.6758,1055.6,458.2758,1062.6,449.8758" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="84.7" x="1064" y="462.1224">sign with prk_idp_sig</text><polygon fill="#A80036" points="487.55,486.418,480.55,489.218,487.55,492.018,484.75,489.218" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:2.0,2.0;" x1="483.35" x2="925.05" y1="489.218" y2="489.218"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="7.7" x="491.75" y="485.8185">8)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="165.9" x="505.05" y="485.8185">RETURN jwt(signed discovery document)</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="479.85" x2="509.25" y1="510.4641" y2="510.4641"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="509.25" x2="509.25" y1="510.4641" y2="519.5641"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="480.55" x2="509.25" y1="519.5641" y2="519.5641"/><polygon fill="#A80036" points="487.55,516.7641,480.55,519.5641,487.55,522.3641,484.75,519.5641" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="7.7" x="484.75" y="507.0646">9)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="70" x="498.05" y="507.0646">validate signature</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="583.1,501.468,768.6,501.468,775.6,509.868,768.6,518.268,583.1,518.268,576.1,509.868,583.1,501.468" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="182.7" x="584.5" y="513.7146">signed with puk_idp_sig cert from x5c header</text><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="2.1" style="stroke:#EEEEEE;stroke-width:0.6999999999999998;" width="1548.05" x="0" y="539.9871"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="539.9871" y2="539.9871"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="542.0871" y2="542.0871"/><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="17.0461" style="stroke:#000000;stroke-width:1.3999999999999997;" width="88.9" x="729.575" y="532.1641"/><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="76.3" x="733.775" y="544.4106">get keys from Idp</text><polygon fill="#A80036" points="913.85,569.0562,920.85,571.8562,913.85,574.6562,916.65,571.8562" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="479.85" x2="918.05" y1="571.8562" y2="571.8562"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="484.75" y="568.4567">10)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="86.8" x="502.95" y="568.4567">GET uri_puk_idp_enc</text><polygon fill="#A80036" points="487.55,590.3023,480.55,593.1023,487.55,595.9023,484.75,593.1023" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:2.0,2.0;" x1="483.35" x2="921.55" y1="593.1023" y2="593.1023"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="491.75" y="589.7028">11)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="153.3" x="509.95" y="589.7028">RETURN jwk(puk_idp_enc public key)</text><polygon fill="#A80036" points="913.85,611.5484,920.85,614.3484,913.85,617.1484,916.65,614.3484" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="479.85" x2="918.05" y1="614.3484" y2="614.3484"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="484.75" y="610.9489">12)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="84" x="502.95" y="610.9489">GET uri_puk_idp_sig</text><polygon fill="#A80036" points="487.55,632.7945,480.55,635.5945,487.55,638.3945,484.75,635.5945" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:2.0,2.0;" x1="483.35" x2="925.05" y1="635.5945" y2="635.5945"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="491.75" y="632.195">13)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="148.4" x="509.95" y="632.195">RETURN jwk(puk_idp_sig certificate)</text><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="2.1" style="stroke:#EEEEEE;stroke-width:0.6999999999999998;" width="1548.05" x="0" y="656.0176"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="656.0176" y2="656.0176"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="658.1176" y2="658.1176"/><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="17.0461" style="stroke:#000000;stroke-width:1.3999999999999997;" width="158.9" x="694.575" y="648.1945"/><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="146.3" x="698.775" y="660.4411">request authentication challenge</text><polygon fill="#A80036" points="1046.15,707.9789,1053.15,710.7789,1046.15,713.5789,1048.95,710.7789" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="479.85" x2="1050.35" y1="710.7789" y2="710.7789"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="484.75" y="695.9333">14)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="116.2" x="502.95" y="684.4872">getAuthenticationChallenge()</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="112" x="502.95" y="695.9333">GET authorization_endpoint</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="217.7" x="502.95" y="707.3794">client_id, state, redirecturl, code_challenge, scope, ...</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1061.55" x2="1090.95" y1="753.025" y2="753.025"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1090.95" x2="1090.95" y1="753.025" y2="762.125"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1062.25" x2="1090.95" y1="762.125" y2="762.125"/><polygon fill="#A80036" points="1069.25,759.325,1062.25,762.125,1069.25,764.925,1066.45,762.125" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1066.45" y="749.6255">15)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="82.6" x="1084.65" y="749.6255">create CHALLENGE</text><path d="M948.5,748.9289 L948.5,753.1289 A7,7 0 0 0 955.5,760.1289 L1040.9,760.1289 A7,7 0 0 0 1047.9,753.1289 L1047.9,748.9289 L1040.9,741.9289 L955.5,741.9289 A7,7 0 0 0 948.5,748.9289 " fill="#90EE90" filter="url(#fnkakhcmzkjcp)" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><path d="M1040.9,741.9289 L1040.9,745.4289 A3.5,3.5 0 0 0 1044.4,748.9289 L1047.9,748.9289 L1040.9,741.9289 " fill="#90EE90" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="84.7" x="952.7" y="754.8755">sign with prk_idp_sig</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1061.55" x2="1090.95" y1="783.3711" y2="783.3711"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1090.95" x2="1090.95" y1="783.3711" y2="792.4711"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1062.25" x2="1090.95" y1="792.4711" y2="792.4711"/><polygon fill="#A80036" points="1069.25,789.6711,1062.25,792.4711,1069.25,795.2711,1066.45,792.4711" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1066.45" y="779.9716">16)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="88.9" x="1084.65" y="779.9716">get USER_CONSENT</text><polygon fill="#A80036" points="487.55,810.9172,480.55,813.7172,487.55,816.5172,484.75,813.7172" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:2.0,2.0;" x1="483.35" x2="1053.85" y1="813.7172" y2="813.7172"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="491.75" y="810.3177">17)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="189.7" x="509.95" y="810.3177">RETURN jwt(CHALLENGE, USER_CONSENT)</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="479.85" x2="509.25" y1="838.4633" y2="838.4633"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="509.25" x2="509.25" y1="838.4633" y2="847.5633"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="476.35" x2="509.25" y1="847.5633" y2="847.5633"/><polygon fill="#A80036" points="483.35,844.7633,476.35,847.5633,483.35,850.3633,480.55,847.5633" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="484.75" y="835.0638">18)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="127.4" x="502.95" y="835.0638">validate CHALLENGE signature</text><path d="M638.4,830.8672 L638.4,835.0672 A7,7 0 0 0 645.4,842.0672 L742.7,842.0672 A7,7 0 0 0 749.7,835.0672 L749.7,830.8672 L742.7,823.8672 L645.4,823.8672 A7,7 0 0 0 638.4,830.8672 " fill="#90EE90" filter="url(#fnkakhcmzkjcp)" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><path d="M742.7,823.8672 L742.7,827.3672 A3.5,3.5 0 0 0 746.2,830.8672 L749.7,830.8672 L742.7,823.8672 " fill="#90EE90" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="96.6" x="642.6" y="836.8138">signed with puk_idp_sig</text><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="2.1" style="stroke:#EEEEEE;stroke-width:0.6999999999999998;" width="1548.05" x="0" y="864.4863"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="864.4863" y2="864.4863"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="866.5863" y2="866.5863"/><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="17.0461" style="stroke:#000000;stroke-width:1.3999999999999997;" width="105" x="721.525" y="856.6633"/><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="92.4" x="725.725" y="868.9099">confirm user consent</text><polygon fill="#A80036" points="77.35,893.5555,70.35,896.3555,77.35,899.1555,74.55,896.3555" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="73.15" x2="472.15" y1="896.3555" y2="896.3555"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="81.55" y="892.956">19)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="105" x="99.75" y="892.956">display USER_CONSENT</text><polygon fill="#A80036" points="467.95,914.8016,474.95,917.6016,467.95,920.4016,470.75,917.6016" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="66.15" x2="472.15" y1="917.6016" y2="917.6016"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="71.05" y="914.2021">20)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="105.7" x="89.25" y="914.2021">confirm USER_CONSENT</text><path d="M245,956.1016 L280.7,956.1016 L280.7,961.7016 L273.7,968.7016 L238,968.7016 L238,963.1016 " fill="#EEEEEE" style="stroke:#000000;stroke-width:0.6999999999999998;"/><rect fill="none" height="950.3758" rx="7" ry="7" style="stroke:#000000;stroke-width:1.3999999999999997;" width="1085" x="238" y="956.1016"/><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="11.2" x="248.5" y="966.2481">alt</text><text fill="#000000" font-family="sans-serif" font-size="7.7" font-weight="bold" lengthAdjust="spacing" textLength="4.9" x="291.2" y="965.4948">[:</text><text fill="#FF6000" font-family="sans-serif" font-size="7.7" font-weight="bold" lengthAdjust="spacing" textLength="194.6" x="298.2" y="965.4948">request token code with SIGNED_CHALLENGE flow]</text><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="2.1" style="stroke:#EEEEEE;stroke-width:0.6999999999999998;" width="1548.05" x="0" y="983.7707"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="983.7707" y2="983.7707"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="985.8707" y2="985.8707"/><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="17.0461" style="stroke:#000000;stroke-width:1.3999999999999997;" width="77.7" x="735.175" y="975.9477"/><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="65.1" x="739.375" y="988.1942">sign challenge</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="476.35" x2="509.25" y1="1012.1398" y2="1012.1398"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="509.25" x2="509.25" y1="1012.1398" y2="1021.2398"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="480.55" x2="509.25" y1="1021.2398" y2="1021.2398"/><polygon fill="#A80036" points="487.55,1018.4398,480.55,1021.2398,487.55,1024.0398,484.75,1021.2398" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="484.75" y="1008.7403">21)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="263.2" x="502.95" y="1008.7403">read AUT certificate from SMC-B (via Konnector) or eGK per NFC</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="479.85" x2="509.25" y1="1057.432" y2="1057.432"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="509.25" x2="509.25" y1="1057.432" y2="1066.532"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="480.55" x2="509.25" y1="1066.532" y2="1066.532"/><polygon fill="#A80036" points="487.55,1063.732,480.55,1066.532,487.55,1069.332,484.75,1066.532" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="484.75" y="1048.3095">22)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="270.2" x="502.95" y="1042.5864">SIGNED_CHALLENGE = jws(njwt: CHALLENGE, aut certificate im</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="47.6" x="502.95" y="1054.0325">x5c header)</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="791,1042.7129,949.9,1042.7129,956.9,1051.1129,949.9,1059.5129,791,1059.5129,784,1051.1129,791,1042.7129" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="156.1" x="792.4" y="1054.9595">sign with c.ch.aut / c.hci.aut / c.hp.aut</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="479.85" x2="509.25" y1="1102.7242" y2="1102.7242"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="509.25" x2="509.25" y1="1102.7242" y2="1111.8242"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="476.35" x2="509.25" y1="1111.8242" y2="1111.8242"/><polygon fill="#A80036" points="483.35,1109.0242,476.35,1111.8242,483.35,1114.6242,480.55,1111.8242" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="484.75" y="1093.6017">23)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="200.2" x="502.95" y="1087.8786">ENCRYPTED_SIGNED_CHALLENGE = jwe(njwt:</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="96.6" x="502.95" y="1099.3247">SIGNED_CHALLENGE)</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="721,1084.5051,826.7,1084.5051,833.7,1092.9051,826.7,1101.3051,721,1101.3051,714,1092.9051,721,1084.5051" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="102.9" x="722.4" y="1096.7517">encrypt with puk_idp_enc</text><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="2.1" style="stroke:#EEEEEE;stroke-width:0.6999999999999998;" width="1548.05" x="0" y="1128.7473"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="1128.7473" y2="1128.7473"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="1130.8473" y2="1130.8473"/><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="17.0461" style="stroke:#000000;stroke-width:1.3999999999999997;" width="131.6" x="708.225" y="1120.9242"/><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="119" x="712.425" y="1133.1708">request authorization code</text><polygon fill="#A80036" points="1046.15,1180.7086,1053.15,1183.5086,1046.15,1186.3086,1048.95,1183.5086" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="476.35" x2="1050.35" y1="1183.5086" y2="1183.5086"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="481.25" y="1168.663">24)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="65.8" x="499.45" y="1157.2169">GetTokenCode()</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="118.3" x="502.25" y="1168.663">POST authorization_endpoint</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="272.3" x="499.45" y="1180.1091">ENCRYPTED_SIGNED_CHALLENGE with certificate in x5c header</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1061.55" x2="1090.95" y1="1228.3277" y2="1228.3277"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1090.95" x2="1090.95" y1="1228.3277" y2="1237.4277"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1062.25" x2="1090.95" y1="1237.4277" y2="1237.4277"/><polygon fill="#A80036" points="1069.25,1234.6277,1062.25,1237.4277,1069.25,1240.2277,1066.45,1237.4277" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1066.45" y="1224.9282">25)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="237.3" x="1084.65" y="1224.9282">decrypt and validate ENCRYPTED_SIGNED_CHALLENGE</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="874.3,1213.6086,1043.7,1213.6086,1050.7,1227.6086,1043.7,1241.6086,874.3,1241.6086,867.3,1227.6086,874.3,1213.6086" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="166.6" x="875.7" y="1225.8552">validate SIGNED_CHALLENGE signature</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="72.1" x="875.7" y="1237.3013">validate certificate</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1061.55" x2="1090.95" y1="1261.2469" y2="1261.2469"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1090.95" x2="1090.95" y1="1261.2469" y2="1270.3469"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1062.25" x2="1090.95" y1="1270.3469" y2="1270.3469"/><polygon fill="#A80036" points="1069.25,1267.5469,1062.25,1270.3469,1069.25,1273.1469,1066.45,1270.3469" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1066.45" y="1257.8474">26)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="139.3" x="1084.65" y="1257.8474">generate AUTHORIZATION_CODE</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="956.2,1252.2508,1043.7,1252.2508,1050.7,1260.6508,1043.7,1269.0508,956.2,1269.0508,949.2,1260.6508,956.2,1252.2508" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="84.7" x="957.6" y="1264.4974">sign with prk_idp_sig</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1061.55" x2="1090.95" y1="1291.593" y2="1291.593"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1090.95" x2="1090.95" y1="1291.593" y2="1300.693"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1062.25" x2="1090.95" y1="1300.693" y2="1300.693"/><polygon fill="#A80036" points="1069.25,1297.893,1062.25,1300.693,1069.25,1303.493,1066.45,1300.693" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1066.45" y="1288.1935">27)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="93.1" x="1084.65" y="1288.1935">generate SSO_TOKEN</text><polygon fill="#A80036" points="484.05,1342.0312,477.05,1344.8312,484.05,1347.6312,481.25,1344.8312" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:2.0,2.0;" x1="479.85" x2="1057.35" y1="1344.8312" y2="1344.8312"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="488.25" y="1329.9856">28)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="245.7" x="506.45" y="1318.5396">RETURN 302 redirect to token end point with location header</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="189" x="506.45" y="1329.9856">containing AUTHORIZATION_CODE, state and</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="121.1" x="506.45" y="1341.4317">SSO_TOKEN as query param</text><path d="M245,1319.016 L245,1334.416 A7,7 0 0 0 252,1341.416 L462.7,1341.416 A7,7 0 0 0 469.7,1334.416 L469.7,1319.016 L462.7,1312.016 L252,1312.016 A7,7 0 0 0 245,1319.016 " fill="#FBFB77" filter="url(#fnkakhcmzkjcp)" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><path d="M462.7,1312.016 L462.7,1315.516 A3.5,3.5 0 0 0 466.2,1319.016 L469.7,1319.016 L462.7,1312.016 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="196.7" x="249.2" y="1324.9626">sso token can be omitted (returned as null value)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="210" x="249.2" y="1336.4087">for specific user agents configured on the IDP server</text><line style="stroke:#000000;stroke-width:0.6999999999999998;stroke-dasharray:2.0,2.0;" x1="238" x2="1323" y1="1410.6312" y2="1410.6312"/><text fill="#000000" font-family="sans-serif" font-size="7.7" font-weight="bold" lengthAdjust="spacing" textLength="4.9" x="241.5" y="1418.6245">[:</text><text fill="#333333" font-family="sans-serif" font-size="7.7" font-weight="bold" lengthAdjust="spacing" textLength="161" x="248.5" y="1418.6245">request token code with SSO Token flow]</text><polygon fill="#A80036" points="1046.15,1445.3086,1053.15,1448.1086,1046.15,1450.9086,1048.95,1448.1086" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="476.35" x2="1050.35" y1="1448.1086" y2="1448.1086"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="481.25" y="1438.986">29)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="65.8" x="499.45" y="1433.263">GetTokenCode()</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="229.6" x="502.25" y="1444.7091">POST /sso_token_endpoint CHALLENGE, SSO_TOKEN</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1061.55" x2="1090.95" y1="1490.3547" y2="1490.3547"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1090.95" x2="1090.95" y1="1490.3547" y2="1499.4547"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1062.25" x2="1090.95" y1="1499.4547" y2="1499.4547"/><polygon fill="#A80036" points="1069.25,1496.6547,1062.25,1499.4547,1069.25,1502.2547,1066.45,1499.4547" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1066.45" y="1486.9552">30)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="88.2" x="1084.65" y="1486.9552">validate SSO_TOKEN</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1061.55" x2="1090.95" y1="1520.7008" y2="1520.7008"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1090.95" x2="1090.95" y1="1520.7008" y2="1529.8008"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1062.25" x2="1090.95" y1="1529.8008" y2="1529.8008"/><polygon fill="#A80036" points="1069.25,1527.0008,1062.25,1529.8008,1069.25,1532.6008,1066.45,1529.8008" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1066.45" y="1517.3013">31)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="139.3" x="1084.65" y="1517.3013">generate AUTHORIZATION_CODE</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="956.2,1511.7047,1043.7,1511.7047,1050.7,1520.1047,1043.7,1528.5047,956.2,1528.5047,949.2,1520.1047,956.2,1511.7047" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="84.7" x="957.6" y="1523.9513">sign with prk_idp_sig</text><polygon fill="#A80036" points="484.05,1559.693,477.05,1562.493,484.05,1565.293,481.25,1562.493" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:2.0,2.0;" x1="479.85" x2="1057.35" y1="1562.493" y2="1562.493"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="488.25" y="1553.3704">32)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="181.3" x="506.45" y="1547.6474">RETURN 302 redirect to token end point with</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="240.8" x="506.45" y="1559.0935">AUTHORIZATION_CODE as query param, no SSO_TOKEN</text><line style="stroke:#000000;stroke-width:0.6999999999999998;stroke-dasharray:2.0,2.0;" x1="238" x2="1323" y1="1596.793" y2="1596.793"/><text fill="#000000" font-family="sans-serif" font-size="7.7" font-weight="bold" lengthAdjust="spacing" textLength="4.9" x="241.5" y="1604.7862">[:</text><text fill="#FF0000" font-family="sans-serif" font-size="7.7" font-weight="bold" lengthAdjust="spacing" textLength="156.8" x="248.5" y="1604.7862">request token code with ALT AUTH flow]</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="476.35" x2="505.75" y1="1625.3973" y2="1625.3973"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="505.75" x2="505.75" y1="1625.3973" y2="1634.4973"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="477.05" x2="505.75" y1="1634.4973" y2="1634.4973"/><polygon fill="#A80036" points="484.05,1631.6973,477.05,1634.4973,484.05,1637.2973,481.25,1634.4973" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="481.25" y="1621.9978">33)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="156.8" x="499.45" y="1621.9978">create and sign SIGNED_AUTH_DATA</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="671.3,1610.6781,797.3,1610.6781,804.3,1624.6781,797.3,1638.6781,671.3,1638.6781,664.3,1624.6781,671.3,1610.6781" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="120.4" x="672.7" y="1622.9247">sign with prk_secure_element</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="102.9" x="672.7" y="1634.3708">encrypt with puk_idp_enc</text><polygon fill="#A80036" points="1046.15,1678.4086,1053.15,1681.2086,1046.15,1684.0086,1048.95,1681.2086" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="476.35" x2="1050.35" y1="1681.2086" y2="1681.2086"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="481.25" y="1666.363">34)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="65.8" x="499.45" y="1654.9169">GetTokenCode()</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="93.8" x="502.25" y="1666.363">POST altauth_endpoint</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="110.6" x="499.45" y="1677.8091">jwe(SIGNED_AUTH_DATA)</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1061.55" x2="1090.95" y1="1723.4547" y2="1723.4547"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1090.95" x2="1090.95" y1="1723.4547" y2="1732.5547"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1062.25" x2="1090.95" y1="1732.5547" y2="1732.5547"/><polygon fill="#A80036" points="1069.25,1729.7547,1062.25,1732.5547,1069.25,1735.3547,1066.45,1732.5547" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1066.45" y="1720.0552">35)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="175" x="1084.65" y="1720.0552">decrypt and validate SIGNED_AUTH_DATA</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1061.55" x2="1090.95" y1="1756.3738" y2="1756.3738"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1090.95" x2="1090.95" y1="1756.3738" y2="1765.4738"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1062.25" x2="1090.95" y1="1765.4738" y2="1765.4738"/><polygon fill="#A80036" points="1069.25,1762.6738,1062.25,1765.4738,1069.25,1768.2738,1066.45,1765.4738" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1066.45" y="1752.9743">36)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="86.8" x="1084.65" y="1752.9743">check block/allow list</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="968.8,1741.6547,1043.7,1741.6547,1050.7,1755.6547,1043.7,1769.6547,968.8,1769.6547,961.8,1755.6547,968.8,1741.6547" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="70" x="970.2" y="1753.9013">validate signature</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="72.1" x="970.2" y="1765.3474">validate certificate</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1061.55" x2="1090.95" y1="1789.293" y2="1789.293"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1090.95" x2="1090.95" y1="1789.293" y2="1798.393"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1062.25" x2="1090.95" y1="1798.393" y2="1798.393"/><polygon fill="#A80036" points="1069.25,1795.593,1062.25,1798.393,1069.25,1801.193,1066.45,1798.393" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1066.45" y="1785.8935">37)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="139.3" x="1084.65" y="1785.8935">generate AUTHORIZATION_CODE</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="956.2,1780.2969,1043.7,1780.2969,1050.7,1788.6969,1043.7,1797.0969,956.2,1797.0969,949.2,1788.6969,956.2,1780.2969" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="84.7" x="957.6" y="1792.5435">sign with prk_idp_sig</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1061.55" x2="1090.95" y1="1819.6391" y2="1819.6391"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1090.95" x2="1090.95" y1="1819.6391" y2="1828.7391"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1062.25" x2="1090.95" y1="1828.7391" y2="1828.7391"/><polygon fill="#A80036" points="1069.25,1825.9391,1062.25,1828.7391,1069.25,1831.5391,1066.45,1828.7391" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1066.45" y="1816.2396">38)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="93.1" x="1084.65" y="1816.2396">generate SSO_TOKEN</text><polygon fill="#A80036" points="484.05,1870.0773,477.05,1872.8773,484.05,1875.6773,481.25,1872.8773" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:2.0,2.0;" x1="479.85" x2="1057.35" y1="1872.8773" y2="1872.8773"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="488.25" y="1858.0317">39)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="245.7" x="506.45" y="1846.5856">RETURN 302 redirect to token end point with location header</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="189" x="506.45" y="1858.0317">containing AUTHORIZATION_CODE, state and</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="121.1" x="506.45" y="1869.4778">SSO_TOKEN as query param</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="476.35" x2="505.75" y1="1927.0234" y2="1927.0234"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="505.75" x2="505.75" y1="1927.0234" y2="1936.1234"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="477.05" x2="505.75" y1="1936.1234" y2="1936.1234"/><polygon fill="#A80036" points="484.05,1933.3234,477.05,1936.1234,484.05,1938.9234,481.25,1936.1234" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="481.25" y="1923.6239">40)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="124.6" x="499.45" y="1923.6239">optionally 2store SSO_TOKEN</text><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="2.1" style="stroke:#EEEEEE;stroke-width:0.6999999999999998;" width="1548.05" x="0" y="1956.5465"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="1956.5465" y2="1956.5465"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="1958.6465" y2="1958.6465"/><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="17.0461" style="stroke:#000000;stroke-width:1.3999999999999997;" width="93.1" x="727.475" y="1948.7234"/><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="80.5" x="731.675" y="1960.97">create key verifier</text><polygon fill="#A80036" points="194.25,1985.6156,187.25,1988.4156,194.25,1991.2156,191.45,1988.4156" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="190.05" x2="475.65" y1="1988.4156" y2="1988.4156"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="198.45" y="1985.0161">41)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="72.8" x="216.65" y="1985.0161">follow 302 redirect</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="186.55" x2="215.95" y1="2030.6617" y2="2030.6617"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="215.95" x2="215.95" y1="2030.6617" y2="2039.7617"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="187.25" x2="215.95" y1="2039.7617" y2="2039.7617"/><polygon fill="#A80036" points="194.25,2036.9617,187.25,2039.7617,194.25,2042.5617,191.45,2039.7617" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="191.45" y="2027.2622">42)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="115.5" x="209.65" y="2027.2622">create random TOKEN_KEY</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="340.2,2021.6656,376.6,2021.6656,383.6,2030.0656,376.6,2038.4656,340.2,2038.4656,333.2,2030.0656,340.2,2021.6656" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="33.6" x="341.6" y="2033.9122">AES256</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="186.55" x2="215.95" y1="2061.0078" y2="2061.0078"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="215.95" x2="215.95" y1="2061.0078" y2="2070.1078"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="187.25" x2="215.95" y1="2070.1078" y2="2070.1078"/><polygon fill="#A80036" points="194.25,2067.3078,187.25,2070.1078,194.25,2072.9078,191.45,2070.1078" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="191.45" y="2057.6083">43)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="233.8" x="209.65" y="2057.6083">create KEY_VERIFIER (TOKEN_KEY, CODE_VERIFIER)</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="186.55" x2="215.95" y1="2091.3539" y2="2091.3539"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="215.95" x2="215.95" y1="2091.3539" y2="2100.4539"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="187.25" x2="215.95" y1="2100.4539" y2="2100.4539"/><polygon fill="#A80036" points="194.25,2097.6539,187.25,2100.4539,194.25,2103.2539,191.45,2100.4539" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="191.45" y="2087.9544">44)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="203" x="209.65" y="2087.9544">encrypted KEY_VERIFIER = jwe(KEY_VERIFIER)</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="427.7,2082.3578,533.4,2082.3578,540.4,2090.7578,533.4,2099.1578,427.7,2099.1578,420.7,2090.7578,427.7,2082.3578" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="102.9" x="429.1" y="2094.6044">encrypt with idp_puk_enc</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="186.55" x2="215.95" y1="2121.7" y2="2121.7"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="215.95" x2="215.95" y1="2121.7" y2="2130.8"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="187.25" x2="215.95" y1="2130.8" y2="2130.8"/><polygon fill="#A80036" points="194.25,2128,187.25,2130.8,194.25,2133.6,191.45,2130.8" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="191.45" y="2118.3005">45)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="258.3" x="209.65" y="2118.3005">store TOKEN_KEY (for derycpting access and id token later on)</text><polygon fill="#A80036" points="464.45,2149.2461,471.45,2152.0461,464.45,2154.8461,467.25,2152.0461" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="186.55" x2="468.65" y1="2152.0461" y2="2152.0461"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="191.45" y="2148.6466">46)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="0" x="212.45" y="2148.6466"/><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="2.1" style="stroke:#EEEEEE;stroke-width:0.6999999999999998;" width="1548.05" x="0" y="2193.4691"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="2193.4691" y2="2193.4691"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="2195.5691" y2="2195.5691"/><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="17.0461" style="stroke:#000000;stroke-width:1.3999999999999997;" width="58.1" x="744.975" y="2185.6461"/><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="45.5" x="749.175" y="2197.8927">get tokens</text><polygon fill="#A80036" points="1318.45,2245.4305,1325.45,2248.2305,1318.45,2251.0305,1321.25,2248.2305" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="479.85" x2="1322.65" y1="2248.2305" y2="2248.2305"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="484.75" y="2233.3849">47)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="47.6" x="502.95" y="2221.9388">getTokens()</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="196" x="502.95" y="2233.3849">POST token_endpoint AUTHORIZATION_CODE,</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="84" x="502.95" y="2244.831">jwe(KEY_VERIFIER)</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1333.85" x2="1363.25" y1="2290.4766" y2="2290.4766"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1363.25" x2="1363.25" y1="2290.4766" y2="2299.5766"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1334.55" x2="1363.25" y1="2299.5766" y2="2299.5766"/><polygon fill="#A80036" points="1341.55,2296.7766,1334.55,2299.5766,1341.55,2302.3766,1338.75,2299.5766" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1338.75" y="2287.0771">48)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="165.2" x="1356.95" y="2287.0771">validate client, code and KEY_VERIFIER</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="1253,2281.4805,1316,2281.4805,1323,2289.8805,1316,2298.2805,1253,2298.2805,1246,2289.8805,1253,2281.4805" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="60.2" x="1254.4" y="2293.7271">verify signature</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1333.85" x2="1363.25" y1="2320.8227" y2="2320.8227"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1363.25" x2="1363.25" y1="2320.8227" y2="2329.9227"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1334.55" x2="1363.25" y1="2329.9227" y2="2329.9227"/><polygon fill="#A80036" points="1341.55,2327.1227,1334.55,2329.9227,1341.55,2332.7227,1338.75,2329.9227" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1338.75" y="2317.4231">49)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="182.7" x="1356.95" y="2317.4231">decrypt KEY_VERIFIER jwe -&gt; TOKEN_KEY</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="1245.3,2311.8266,1316,2311.8266,1323,2320.2266,1316,2328.6266,1245.3,2328.6266,1238.3,2320.2266,1245.3,2311.8266" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="67.9" x="1246.7" y="2324.0731">with prk_idp_enc</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1333.85" x2="1363.25" y1="2351.1687" y2="2351.1687"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1363.25" x2="1363.25" y1="2351.1687" y2="2360.2687"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="1334.55" x2="1363.25" y1="2360.2687" y2="2360.2687"/><polygon fill="#A80036" points="1341.55,2357.4687,1334.55,2360.2687,1341.55,2363.0687,1338.75,2360.2687" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="1338.75" y="2347.7692">50)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="170.8" x="1356.95" y="2347.7692">encrypt ACCESS_TOKEN and ID_TOKEN</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="1239.7,2342.1727,1316,2342.1727,1323,2350.5727,1316,2358.9727,1239.7,2358.9727,1232.7,2350.5727,1239.7,2342.1727" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="73.5" x="1241.1" y="2354.4192">with TOKEN_KEY</text><polygon fill="#A80036" points="487.55,2390.1609,480.55,2392.9609,487.55,2395.7609,484.75,2392.9609" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:2.0,2.0;" x1="483.35" x2="1329.65" y1="2392.9609" y2="2392.9609"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="491.75" y="2383.8384">51)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="194.6" x="509.95" y="2378.1153">RETURN jwe(ACCESS_TOKEN, TOKEN_KEY),</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="123.2" x="509.95" y="2389.5614">jwe(ID_TOKEN, TOKEN_KEY)</text><polygon fill="#A80036" points="194.25,2422.8531,187.25,2425.6531,194.25,2428.4531,191.45,2425.6531" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:2.0,2.0;" x1="190.05" x2="475.65" y1="2425.6531" y2="2425.6531"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="198.45" y="2416.5306">52)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="205.1" x="216.65" y="2410.8075">FORWARD jwe(ACCESS_TOKEN, TOKEN_KEY),</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="123.2" x="216.65" y="2422.2536">jwe(ID_TOKEN, TOKEN_KEY)</text><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="2.1" style="stroke:#EEEEEE;stroke-width:0.6999999999999998;" width="1548.05" x="0" y="2446.0762"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="2446.0762" y2="2446.0762"/><line style="stroke:#000000;stroke-width:0.6999999999999998;" x1="0" x2="1548.05" y1="2448.1762" y2="2448.1762"/><rect fill="#EEEEEE" filter="url(#fnkakhcmzkjcp)" height="17.0461" style="stroke:#000000;stroke-width:1.3999999999999997;" width="149.8" x="699.125" y="2438.2531"/><text fill="#000000" font-family="sans-serif" font-size="9.1" font-weight="bold" lengthAdjust="spacing" textLength="137.2" x="703.325" y="2450.4997">use access token at Fachdienst</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="186.55" x2="215.95" y1="2477.9453" y2="2477.9453"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="215.95" x2="215.95" y1="2477.9453" y2="2487.0453"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="187.25" x2="215.95" y1="2487.0453" y2="2487.0453"/><polygon fill="#A80036" points="194.25,2484.2453,187.25,2487.0453,194.25,2489.8453,191.45,2487.0453" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="191.45" y="2474.5458">53)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="106.4" x="209.65" y="2474.5458">decrypt ACCESS_TOKEN</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="92.4,2468.9492,168.7,2468.9492,175.7,2477.3492,168.7,2485.7492,92.4,2485.7492,85.4,2477.3492,92.4,2468.9492" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="73.5" x="93.8" y="2481.1958">with TOKEN_KEY</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="186.55" x2="215.95" y1="2508.2914" y2="2508.2914"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="215.95" x2="215.95" y1="2508.2914" y2="2517.3914"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="187.25" x2="215.95" y1="2517.3914" y2="2517.3914"/><polygon fill="#A80036" points="194.25,2514.5914,187.25,2517.3914,194.25,2520.1914,191.45,2517.3914" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="191.45" y="2504.8919">54)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="77" x="209.65" y="2504.8919">decrypt ID_TOKEN</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="92.4,2499.2953,168.7,2499.2953,175.7,2507.6953,168.7,2516.0953,92.4,2516.0953,85.4,2507.6953,92.4,2499.2953" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="73.5" x="93.8" y="2511.5419">with TOKEN_KEY</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="186.55" x2="215.95" y1="2538.6375" y2="2538.6375"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="215.95" x2="215.95" y1="2538.6375" y2="2547.7375"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="187.25" x2="215.95" y1="2547.7375" y2="2547.7375"/><polygon fill="#A80036" points="194.25,2544.9375,187.25,2547.7375,194.25,2550.5375,191.45,2547.7375" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="191.45" y="2535.238">55)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="106.4" x="209.65" y="2535.238">encrypt ACCESS_TOKEN</text><polygon fill="#90EE90" filter="url(#fnkakhcmzkjcp)" points="10.5,2529.6414,169.4,2529.6414,176.4,2538.0414,169.4,2546.4414,10.5,2546.4414,3.5,2538.0414,10.5,2529.6414" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="156.1" x="11.9" y="2541.888">with shared secret between FL and FD</text><polygon fill="#A80036" points="772.45,2566.1836,779.45,2568.9836,772.45,2571.7836,775.25,2568.9836" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="186.55" x2="776.65" y1="2568.9836" y2="2568.9836"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="191.45" y="2565.5841">56)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="182.7" x="209.65" y="2565.5841">sendAccessTokenAndRequestedFachdaten()</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="787.85" x2="817.25" y1="2611.2297" y2="2611.2297"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="817.25" x2="817.25" y1="2611.2297" y2="2620.3297"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="788.55" x2="817.25" y1="2620.3297" y2="2620.3297"/><polygon fill="#A80036" points="795.55,2617.5297,788.55,2620.3297,795.55,2623.1297,792.75,2620.3297" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="792.75" y="2607.8302">57)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="106.4" x="810.95" y="2607.8302">validate ACCESS_TOKEN</text><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="787.85" x2="817.25" y1="2641.5758" y2="2641.5758"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="817.25" x2="817.25" y1="2641.5758" y2="2650.6758"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="788.55" x2="817.25" y1="2650.6758" y2="2650.6758"/><polygon fill="#A80036" points="795.55,2647.8758,788.55,2650.6758,795.55,2653.4758,792.75,2650.6758" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="792.75" y="2638.1763">58)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="46.2" x="810.95" y="2638.1763">getClaims()</text><polygon fill="#A80036" points="194.25,2669.1219,187.25,2671.9219,194.25,2674.7219,191.45,2671.9219" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;stroke-dasharray:2.0,2.0;" x1="190.05" x2="783.65" y1="2671.9219" y2="2671.9219"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="198.45" y="2668.5224">59)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="81.9" x="216.65" y="2668.5224">RETURN Fachdaten</text><polygon fill="#A80036" points="73.85,2690.368,66.85,2693.168,73.85,2695.968,71.05,2693.168" style="stroke:#A80036;stroke-width:0.6999999999999998;"/><line style="stroke:#A80036;stroke-width:0.6999999999999998;" x1="69.65" x2="182.35" y1="2693.168" y2="2693.168"/><text fill="#0000FF" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="12.6" x="78.05" y="2689.7685">60)</text><text fill="#000000" font-family="sans-serif" font-size="9.1" lengthAdjust="spacing" textLength="78.4" x="96.25" y="2689.7685">displayFachDaten()</text><!--MD5=[375569ab1c9679f19d98fa09898c004b]
@startuml

title
<img:images/IDPLogo-64.png> <u>IDP signed challenge workflow</u>
end title

skinparam sequenceArrowThickness 1
skinparam roundcorner 20
skinparam sequenceParticipant underline
skinparam maxMessageSize 400
skinparam ParticipantPadding 10

autonumber "<font color='blue'>##) "

!includesub workflow.base.puml!Actors

note across #lightyellow
  In the following sequence diagramm
    <b>jwt(XXXX)</b> denotes a JSON web token,  <b>jwe(XXXX)</b> denotes an encrypted JSON web token, <b>jwk(XXX)</b> denotes a JSON web key

  lightgreen hexagons contain PKI infos
end note

||40||

!includesub workflow.base.puml!GetCertsFromFD
!includesub workflow.base.puml!ChooseCodeVerifier
!includesub workflow.base.puml!GetDiscoveryDoc
!includesub workflow.base.puml!GetKeysFromIDP
!includesub workflow.base.puml!RequestAuthenticationChallenge
!includesub workflow.base.puml!ConfirmUserConsent

||40||

alt #ffffe0 : <font color="#ff6000">request token code with SIGNED_CHALLENGE flow
    !includesub workflow.base.puml!SignChallenge
    !includesub workflow.base.puml!RequestAuthorizationCodeWithSignedChallenge
    ||40||
else #eeeeee : <font color="#333333">request token code with SSO Token flow
    !includesub workflow.base.puml!RequestAuthorizationCodeWithSSOToken
    ||40||
else #ffeeee : <font color="red">request token code with ALT AUTH flow
    !includesub workflow.base.puml!RequestAuthorizationCodeWithAltAuth
    ||40||
end

    authM -> authM : optionally 2store SSO_TOKEN

!includesub workflow.base.puml!CreateKeyVerifier

!includesub workflow.base.puml!GetTokens

!includesub workflow.base.puml!UseAccessTokenAtFD

@enduml

@startuml

title
<img:images/IDPLogo-64.png> <u>IDP signed challenge workflow</u>
end title

skinparam sequenceArrowThickness 1
skinparam roundcorner 20
skinparam sequenceParticipant underline
skinparam maxMessageSize 400
skinparam ParticipantPadding 10

autonumber "<font color='blue'>##) "

actor "Versicherte:r" as V
participant "Fachlogik" as FL
participant Authenticator as authM
participant Fachdienst as FD

box #skyblue
participant IDP_Discovery as IDPDisc
participant IDP_Authorization as IDPAuth
participant IDP_Token as IDPToken
endbox

note across #lightyellow
  In the following sequence diagramm
    <b>jwt(XXXX)</b> denotes a JSON web token,  <b>jwe(XXXX)</b> denotes an encrypted JSON web token, <b>jwk(XXX)</b> denotes a JSON web key

  lightgreen hexagons contain PKI infos
end note

||40||

activate FL
FL -> FD : GET CertList
FL <- - FD : RETURN certificates
== choose code verifier ==

    FL -> FL : generate CODE_VERIFIER
    FL -> FL : CODE_CHALLENGE = hash(CODE_VERIFIER)
    hnote right #lightgreen : sha256
    deactivate FL
== get discovery doc  ==
    authM -> IDPDisc ++ : getDiscoveryDocument()\nGET uri_disc
    IDPDisc -> IDPDisc : build discovery document
    IDPDisc -> IDPDisc : sign discovery document
    hnote right #lightgreen : sign with prk_idp_sig
    authM <- - IDPDisc - - : RETURN jwt(signed discovery document)
    activate authM
    authM -> authM : validate signature
    hnote right #lightgreen : signed with puk_idp_sig cert from x5c header
== get keys from Idp ==
    authM -> IDPDisc ++ : GET uri_puk_idp_enc
    authM <- - IDPDisc : RETURN jwk(puk_idp_enc public key)
    authM -> IDPDisc : GET uri_puk_idp_sig
    authM <- - IDPDisc - - : RETURN jwk(puk_idp_sig certificate)
== request authentication challenge ==
    authM -> IDPAuth ++ : getAuthenticationChallenge()\nGET authorization_endpoint\nclient_id, state, redirecturl, code_challenge, scope, ...
    deactivate authM
    IDPAuth -> IDPAuth : create CHALLENGE
    note left #lightgreen : sign with prk_idp_sig
    IDPAuth -> IDPAuth : get USER_CONSENT
    IDPAuth - -> authM ++ : RETURN jwt(CHALLENGE, USER_CONSENT)
    authM -> authM : validate CHALLENGE signature
    note right #lightgreen : signed with puk_idp_sig
    deactivate IDPAuth
== confirm user consent ==
    authM -> V ++ : display USER_CONSENT
    authM <- V - - : confirm USER_CONSENT
    deactivate authM

||40||

alt #ffffe0 : <font color="#ff6000">request token code with SIGNED_CHALLENGE flow
== sign challenge ==
    authM -> authM++ : read AUT certificate from SMC-B (via Konnector) or eGK per NFC
    authM -> authM : SIGNED_CHALLENGE = jws(njwt: CHALLENGE, aut certificate im x5c header)
    hnote right #lightgreen : sign with c.ch.aut / c.hci.aut / c.hp.aut
    authM -> authM- - : ENCRYPTED_SIGNED_CHALLENGE = jwe(njwt: SIGNED_CHALLENGE)
    hnote right #lightgreen : encrypt with puk_idp_enc
== request authorization code ==
    authM -> IDPAuth ++ : GetTokenCode()\n POST authorization_endpoint\nENCRYPTED_SIGNED_CHALLENGE with certificate in x5c header
    deactivate authM
    IDPAuth -> IDPAuth : decrypt and validate ENCRYPTED_SIGNED_CHALLENGE
    hnote left #lightgreen : validate SIGNED_CHALLENGE signature\nvalidate certificate
    IDPAuth -> IDPAuth : generate AUTHORIZATION_CODE
    hnote left #lightgreen : sign with prk_idp_sig
    IDPAuth -> IDPAuth : generate SSO_TOKEN
    IDPAuth - -> authM : RETURN 302 redirect to token end point with location header\ncontaining AUTHORIZATION_CODE, state and\nSSO_TOKEN as query param
    note left : sso token can be omitted (returned as null value)\nfor specific user agents configured on the IDP server
    deactivate authM
    deactivate IDPAuth
    ||45||
    ||40||
else #eeeeee : <font color="#333333">request token code with SSO Token flow
    authM -> IDPAuth ++ : GetTokenCode()\n POST /sso_token_endpoint CHALLENGE, SSO_TOKEN
    deactivate authM
    IDPAuth -> IDPAuth : validate SSO_TOKEN
    IDPAuth -> IDPAuth: generate AUTHORIZATION_CODE
    hnote left #lightgreen : sign with prk_idp_sig
    IDPAuth - -> authM : RETURN 302 redirect to token end point with AUTHORIZATION_CODE as query param, no SSO_TOKEN
    deactivate IDPAuth
    deactivate authM
    ||40||
else #ffeeee : <font color="red">request token code with ALT AUTH flow
    authM -> authM : create and sign SIGNED_AUTH_DATA
    hnote right #lightgreen : sign with prk_secure_element \nencrypt with puk_idp_enc
    authM -> IDPAuth ++ : GetTokenCode()\n POST altauth_endpoint\njwe(SIGNED_AUTH_DATA)
    deactivate authM
    IDPAuth -> IDPAuth : decrypt and validate SIGNED_AUTH_DATA
    IDPAuth -> IDPAuth : check block/allow list
    hnote left #lightgreen : validate signature\nvalidate certificate
    IDPAuth -> IDPAuth : generate AUTHORIZATION_CODE
    hnote left #lightgreen : sign with prk_idp_sig
    IDPAuth -> IDPAuth : generate SSO_TOKEN
    IDPAuth - -> authM : RETURN 302 redirect to token end point with location header\ncontaining AUTHORIZATION_CODE, state and\nSSO_TOKEN as query param
    deactivate IDPAuth
    deactivate authM
    ||40||
end

    authM -> authM : optionally 2store SSO_TOKEN

== create key verifier ==
    authM -> FL ++ : follow 302 redirect
    deactivate authM
    FL -> FL : create random TOKEN_KEY
    hnote right #lightgreen : AES256
    FL -> FL : create KEY_VERIFIER (TOKEN_KEY, CODE_VERIFIER)
    FL -> FL : encrypted KEY_VERIFIER = jwe(KEY_VERIFIER)
    hnote right #lightgreen : encrypt with idp_puk_enc
    FL -> FL : store TOKEN_KEY (for derycpting access and id token later on)
    FL -> authM ++
    deactivate FL

== get tokens ==

    authM -> IDPToken ++ : getTokens()\nPOST token_endpoint AUTHORIZATION_CODE, jwe(KEY_VERIFIER)
    deactivate authM
    IDPToken -> IDPToken : validate client, code and KEY_VERIFIER
    hnote left #lightgreen : verify signature
    IDPToken -> IDPToken : decrypt KEY_VERIFIER jwe -> TOKEN_KEY
    hnote left #lightgreen : with prk_idp_enc
    IDPToken -> IDPToken : encrypt ACCESS_TOKEN and ID_TOKEN
    hnote left #lightgreen : with TOKEN_KEY
    authM <- - IDPToken - - : RETURN jwe(ACCESS_TOKEN, TOKEN_KEY),\njwe(ID_TOKEN, TOKEN_KEY)
    activate authM
    authM - -> FL : FORWARD jwe(ACCESS_TOKEN, TOKEN_KEY),\njwe(ID_TOKEN, TOKEN_KEY)
    deactivate authM

== use access token at Fachdienst ==

    activate FL
    FL -> FL : decrypt ACCESS_TOKEN
    hnote left #lightgreen : with TOKEN_KEY
    FL -> FL : decrypt ID_TOKEN
    hnote left #lightgreen : with TOKEN_KEY
    FL -> FL : encrypt ACCESS_TOKEN
    hnote left #lightgreen : with shared secret between FL and FD
    FL -> FD ++ : sendAccessTokenAndRequestedFachdaten()
    deactivate FL
    FD -> FD : validate ACCESS_TOKEN
    FD -> FD : getClaims()
    FL <- - FD - - : RETURN Fachdaten
    activate FL
    FL -> V : displayFachDaten()
    deactivate FL

@enduml

PlantUML version 1.2021.4(Sun Apr 04 10:49:39 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: Dynamic Code Evolution 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>